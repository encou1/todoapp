<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>노거수</title>
    <Description>
	hong.csv파일의 첫번째 컬럼(답사여부)의 값을  O,X로 변경하면 그에 따라 지도내의 나무 이미지가 변경됨
	아래 에서 for루프 돌아가는 부분이 비효율적으로 반복되는것은 예산의 노거수 리스트가 추가될때 개선할 예정임
    </Description>
	<style>
	        /* HTML과 body의 기본 크기를 설정 */
	        html, body {
	            margin: 0;
	            padding: 0;
	            width: 100%;
	            height: 100%;
	        }
	
	        /* #map div를 화면 전체로 확장 */
	        #map {
	            width: 100%;
	            height: 100%;
	        }
	</style>
</head>
<body>
<div id="map"></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3afaaf74020c04fd36df50d296266032"></script>
<script>
var locPosition;
var mapContainer = document.getElementById('map'); // 지도를 표시할 div
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        function(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            locPosition = new kakao.maps.LatLng(latitude, longitude);
            initializeMap(); // 지도를 여기서 초기화
        },
        function() {
            locPosition = new kakao.maps.LatLng(36.6642233222049, 126.67012925835448);
            initializeMap(); // 지도를 기본 위치로 초기화
        }
    );
} else {
    locPosition = new kakao.maps.LatLng(36.6642233222049, 126.67012925835448);
    initializeMap();
}

function initializeMap() {
    mapOption = {
        center: locPosition, // 지도의 중심좌표
        level: 8 // 지도의 확대 레벨
    };
    var map = new kakao.maps.Map(mapContainer, mapOption);
    initializeMarkers(map); // 마커 표시 함수
}

function initializeMarkers(){	
	// 마커 이미지의 이미지 주소입니다
	var OTreeImg = "/todoapp/image/tree2.png"; 
	var XTreeImg = "/todoapp/image/tree.png"; 
	var imageSize = new kakao.maps.Size(48, 70);     
		
	const OTreeAry = [];		//답사완료나무배열
	const XTreeAry = [];		//답사미완료나무배열
		window.addEventListener("DOMContentLoaded", () => {
			fetch("/todoapp/hong.csv")
				.then(response => response.text())
				.then(csvContent => {
					const rows = csvContent.split("\n").map(row => row.split(","));
					OAry = {};
					rows.forEach(row => {
						OAry = {txt : row[6] +"  " +row[10],title: row[19] + " - "+row[6] +" 수령:"+row[10], latlng: new kakao.maps.LatLng(row[20], row[21])};						
						if (row[0] === "O") {
							OTreeAry.push(OAry);
						} else if (row[0] === "X") {
							XTreeAry.push(OAry);
						}
						//console.log("답사여부:"+row[0] +"수종:"+row[6] +"나이:"+row[10] +"주소:"+row[19] +"위도:"+row[20]+"경도:"+row[21]);
	
					});
					//답사완료나무 마커표시
					//console.log(OTreeAry);
					createMarkers(OTreeAry, map, OTreeImg);
					
					
					//답사미완나무  마커표시
					//console.log(XTreeAry);
					createMarkers(XTreeAry, map, XTreeImg);
					
				});
		});
}	
function createMarkers(treeArray, map, imageSrc) {
    const imageSize = new kakao.maps.Size(48, 70);
    const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
    treeArray.forEach(tree => {
        new kakao.maps.Marker({
            map: map,
            position: tree.latlng,
            image: markerImage,
            title: tree.title
        });
    });
}
	
</script>
</body>
</html>
